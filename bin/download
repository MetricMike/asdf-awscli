#!/usr/bin/env bash
set -euo pipefail

# check ASDF environment variables
[ -n "${ASDF_INSTALL_VERSION}" ] || (echo 'Missing ASDF_INSTALL_VERSION' >&2 && exit 1)
[ -n "${ASDF_DOWNLOAD_PATH}" ] || (echo 'Missing ASDF_DOWNLOAD_PATH' >&2 && exit 1)

case "$(uname -s)" in
"Darwin")
    DOWNLOAD_URL="https://awscli.amazonaws.com/AWSCLIV2-${ASDF_INSTALL_VERSION}.pkg"
    OBJECT_NAME=AWSCLIV2.pkg
    ;;
"Linux")
    case "${ASDF_INSTALL_VERSION:0:1}" in
    "1")
        DOWNLOAD_URL="https://s3.amazonaws.com/aws-cli/awscli-bundle-${ASDF_INSTALL_VERSION}.zip"
        OBJECT_NAME=awscli-bundle.zip
        ;;
    "2")
        DOWNLOAD_URL="https://awscli.amazonaws.com/awscli-exe-linux-x86_64-${ASDF_INSTALL_VERSION}.zip"
        OBJECT_NAME=awscliv2.zip
        ;;
    esac
    ;;
esac

rm -f "${ASDF_DOWNLOAD_PATH}/${OBJECT_NAME}"
curl -sfL -o "${ASDF_DOWNLOAD_PATH}/${OBJECT_NAME}" "${DOWNLOAD_URL}"
