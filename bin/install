#!/usr/bin/env bash
set -euo pipefail

# required environment variables
: "${ASDF_INSTALL_PATH?}"
: "${ASDF_DOWNLOAD_PATH?}"

case "$(uname -s)" in
"Darwin")
	# trying to avoid sudo
	# sudo installer -pkg "${ASDF_DOWNLOAD_PATH}/AWSCLIV2.pkg" -target /

	# unzip the osx pkg content
	tar xf "${ASDF_DOWNLOAD_PATH}/AWSCLIV2.pkg"
	tar xf Payload
	mv pkg/usr/local/* "${ASDF_INSTALL_PATH}"
	;;
"Linux")
	unzip -q "${ASDF_DOWNLOAD_PATH}/awscliv2.zip"
	./aws/install --install-dir "${ASDF_INSTALL_PATH}" --bin-dir "${ASDF_INSTALL_PATH}/bin"
	;;
esac
