#!/usr/bin/env bash
set -euo pipefail

# required environment variables
: "${ASDF_INSTALL_PATH?}"
: "${ASDF_DOWNLOAD_PATH?}"

case "$(uname -s)" in
"Darwin")
	# trying to avoid sudo
	# sudo installer -pkg "${ASDF_DOWNLOAD_PATH}/AWSCLIV2.pkg" -target /

	# unzip the osx pkg content
	pkgutil --expand-full "${ASDF_DOWNLOAD_PATH}/AWSCLIV2.pkg" ./AWSCLIV2
	ls -halt ./AWSCLIV2/aws-cli.pkg/
	mv AWSCLIV2/aws-cli.pkg/* "${ASDF_INSTALL_PATH}"
	;;
"Linux")
	unzip -q "${ASDF_DOWNLOAD_PATH}/awscliv2.zip"
	./aws/install --install-dir "${ASDF_INSTALL_PATH}" --bin-dir "${ASDF_INSTALL_PATH}/bin"
	;;
esac
